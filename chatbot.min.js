function initChatbot() {
    if (!window.lovinbotChatbotConfig) {
        console.error('Lovinbot config not found');
        return;
    }

    const {token, imageToggle, popOver, baseUrl, colorBg} = window.lovinbotChatbotConfig;

    function embedChatbot() {
        const message = {
            action: "updateContent",
            token,
            imageToggle,
            popOver,
            colorBg,
            baseUrl,
        };
        
        const iframe = document.getElementById('lovinbot-chatbot-iframe');
        if (iframe) {
            iframe.onload = function() {
                iframe.contentWindow.postMessage(message, '*');
            }
        }
    }

    // Lắng nghe message từ iframe
    window.addEventListener("message", (event) => {
        if (!event.origin.includes(baseUrl)) return;
        if (event.data.action === "resizeIframe") {
            const iframe = document.getElementById("lovinbot-chatbot-iframe");
            if (iframe) {
                iframe.style.width = `${event.data.width}px`;
                iframe.style.height = `${event.data.height}px`;
            }
        }
    });

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', embedChatbot);
    } else {
        embedChatbot();
    }
}

initChatbot();
